<!-- a3024842-c3ba-4a17-9ee6-bc73bf907393 e9b63f2e-a24c-4860-96f5-329a18962d10 -->
# Rock Pattern Type Toggle

## Problem

Both Mountain/Rock and Grey Rock patterns can be saved, but currently Grey Rock always wins due to priority order. User needs to choose which one applies.

## Solution

Add a "Rock Type" preference that determines which saved pattern gets used during generation.

### 1. Add Rock Type Toggle to UI

In [terrain_generator_demo.html](terrain_generator_demo.html), add a radio button group below the biome selector (around line 715):

```html
<!-- Rock Pattern Type Toggle (only visible when a rock biome is selected) -->
<div id="rockTypeToggle" style="margin-top: 10px; display: none;">
    <label style="color: #aaa;">Active Rock Type:</label>
    <label><input type="radio" name="rockType" value="rock_mountain" checked> Mountain/Rock</label>
    <label><input type="radio" name="rockType" value="rock" style="margin-left: 10px;"> Grey Rock</label>
</div>
```

### 2. Save/Load Rock Type Preference

Save the preference to localStorage alongside patterns:

- Key: `activeRockType`
- Values: `"rock_mountain"` or `"rock"`

### 3. Update Pattern Selection Logic

In [js/data/uoTileSetsClean.js](js/data/uoTileSetsClean.js), modify `getCleanTileAtPosition()` and `getContextualTile()` to check the saved preference:

```javascript
if (biome === 'rock') {
    // Check user preference for which rock pattern to use
    const activeRockType = localStorage.getItem('activeRockType') || 'rock_mountain';
    const patternTile = getBlobPatternTile(activeRockType, x, y);
    if (patternTile) return patternTile;
    
    // Fallback: try the other rock type
    const fallbackType = activeRockType === 'rock_mountain' ? 'rock' : 'rock_mountain';
    const fallbackTile = getBlobPatternTile(fallbackType, x, y);
    if (fallbackTile) return fallbackTile;
}
```

### 4. Show/Hide Toggle Based on Biome

Add JavaScript to show the toggle only when Mountain/Rock or Grey Rock is selected in the biome dropdown.

## Files to Modify

- [terrain_generator_demo.html](terrain_generator_demo.html) - UI toggle and save/load logic
- [js/data/uoTileSetsClean.js](js/data/uoTileSetsClean.js) - Pattern selection respects preference

### To-dos

- [ ] Design stamp-based placement algorithm for 3x3 patterns
- [ ] Find edge locations and determine edge direction
- [ ] Place complete 3x3 stamps as units along edges
- [ ] Test stamp placement with labels enabled
- [ ] Rename water_tile_teacher.html to biome_edge_configurator.html
- [ ] Update file references in terrain_generator_demo.html and other files
- [ ] Update configurator to save full 3x3 binary pattern shape with center tile
- [ ] Implement 3x3 pattern matching in terrainGeneratorV2.js
- [ ] Test pattern matching with Procedural Enhanced generation
- [ ] Update biome_edge_configurator.html to save all 9 tiles with position keys
- [ ] Add getPatternTileForPosition() to map neighbor config to pattern position
- [ ] Update applyTerrainEdgeTiles() to apply position-based tiles from patterns
- [ ] Test that all 9 tiles from pattern appear correctly on generated terrain
- [ ] Update biome_edge_configurator.html to save all 9 tiles with position keys
- [ ] Add getPatternTileForPosition() to map neighbor config to pattern position
- [ ] Update applyTerrainEdgeTiles() to apply position-based tiles from patterns
- [ ] Test that all 9 tiles from pattern appear correctly on generated terrain
- [ ] Rename water_tile_teacher.html to biome_edge_configurator.html
- [ ] Update file references in terrain_generator_demo.html and other files
- [ ] Update configurator to save full 3x3 binary pattern shape with center tile
- [ ] Implement 3x3 pattern matching in terrainGeneratorV2.js
- [ ] Test pattern matching with Procedural Enhanced generation
- [ ] Add colored stamp outlines in renderPatternLabels() function
- [ ] Add debug logging to identify why rock-grass tiles are being skipped
- [ ] Fix edge detection to include all rock-grass boundary tiles
- [ ] Add colored stamp outlines in renderPatternLabels() function
- [ ] Add debug logging to identify why rock-grass tiles are being skipped
- [ ] Fix edge detection to include all rock-grass boundary tiles
- [ ] Implement stamp-based 3x3 pattern placement
- [ ] Design stamp-based placement algorithm for 3x3 patterns
- [ ] Find edge locations and determine edge direction
- [ ] Place complete 3x3 stamps as units along edges
- [ ] Test stamp placement with labels enabled
- [ ] Store pattern.directionId on tiles in placeStamp() function
- [ ] Update label rendering to show stampConfigName (at CENTER tile)
- [ ] Store pattern.directionId on tiles in placeStamp() function
- [ ] Update label rendering to show stampConfigName (at CENTER tile)
- [ ] Design stamp-based placement algorithm for 3x3 patterns
- [ ] Find edge locations and determine edge direction
- [ ] Place complete 3x3 stamps as units along edges
- [ ] Test stamp placement with labels enabled
- [ ] Add colored stamp outlines in renderPatternLabels() function
- [ ] Add debug logging to identify why rock-grass tiles are being skipped
- [ ] Fix edge detection to include all rock-grass boundary tiles
- [ ] Implement stamp-based 3x3 pattern placement
- [ ] Add console logging for direction detection and pattern matching
- [ ] Store detectedDirection and matchedPattern on tiles
- [ ] Update label display to show detected vs matched direction
- [ ] Add console logging for direction detection and pattern matching
- [ ] Store detectedDirection and matchedPattern on tiles
- [ ] Update label display to show detected vs matched direction
- [ ] Add rock type radio toggle UI to terrain_generator_demo.html
- [ ] Add localStorage save/load for activeRockType preference
- [ ] Update uoTileSetsClean.js to respect activeRockType preference
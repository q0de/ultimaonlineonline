<!-- a3024842-c3ba-4a17-9ee6-bc73bf907393 11bcfe6a-1699-4831-b3d8-f886e739c3b2 -->
# Debug Direction Detection and Pattern Matching

## Current Flow

1. `getStampDirection()` detects direction (N/S/E/W/NE/NW/SE/SW) based on neighbor biomes
2. `applyStampBasedTransitions()` maps direction to pattern name (e.g., `N` -> `north`)
3. Pattern matching searches for patterns ending with `_north`, `corner_ne`, `inner_se`, etc.

## Debug Steps

### 1. Add console logging for direction detection

In [js/data/waterTileMappings.js](js/data/waterTileMappings.js), inside `applyStampBasedTransitions()` around line 561, log:

- Which neighbors are detected (hasN, hasS, hasE, hasW, etc.)
- What direction is returned
- What pattern name we're searching for
```javascript
console.log(`[Stamp Debug] Tile (${x},${y}): neighbors=[N:${hasN}, S:${hasS}, E:${hasE}, W:${hasW}] -> direction=${direction}`);
```


### 2. Add console logging for pattern matching

After pattern matching (line 572-587), log:

- Available pattern directionIds
- Which pattern was matched (or if fallback was used)
```javascript
const availablePatterns = patterns.map(p => p.directionId).join(', ');
console.log(`[Stamp Debug] Looking for "${fullDirection}" in [${availablePatterns}] -> matched: ${matchingPattern?.directionId || 'FALLBACK'}`);
```


### 3. Store debug info on tiles for label display

Add to the tile when stamp is placed:

- `tile.detectedDirection` - raw direction from getStampDirection()
- `tile.matchedPattern` - the directionId of the matched pattern

### 4. Update label display to show debug info

In [terrain_generator_demo.html](terrain_generator_demo.html), in `renderPatternLabels()`, show:

- Detected direction (what the code thinks the edge is)
- Matched pattern name (what pattern was selected)

This will make it visually obvious when detection doesn't match expectations.

## Files to Modify

- [js/data/waterTileMappings.js](js/data/waterTileMappings.js) - Add logging and store debug info on tiles
- [terrain_generator_demo.html](terrain_generator_demo.html) - Update labels to show detected direction vs matched pattern

### To-dos

- [ ] Design stamp-based placement algorithm for 3x3 patterns
- [ ] Find edge locations and determine edge direction
- [ ] Place complete 3x3 stamps as units along edges
- [ ] Test stamp placement with labels enabled
- [ ] Add colored stamp outlines in renderPatternLabels() function
- [ ] Add debug logging to identify why rock-grass tiles are being skipped
- [ ] Fix edge detection to include all rock-grass boundary tiles
- [ ] Implement stamp-based 3x3 pattern placement
- [ ] Add console logging for direction detection and pattern matching
- [ ] Store detectedDirection and matchedPattern on tiles
- [ ] Update label display to show detected vs matched direction